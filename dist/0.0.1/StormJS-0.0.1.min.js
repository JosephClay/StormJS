!function(a,b,c,d){var e=a.Storm,f=a.Storm={name:"StormJS",VERSION:"0.0.1",ajax:a.$||{ajax:function(){g.error(f.name+": Storm.ajax NYI")}},$:a.$||function(){g.error(f.name+": Storm.$ NYI")}},g=a.console||{};g.log=g.log||function(){},g.error=g.error||g.log;var h=function(a){return function(b){a.slice.call(b)}}([]),i=function(a){return null!==a&&a!==d},j=function(){var a=new RegExp("{([^}])+}","g");return function(b,c){return b.replace(a,function(a,b){return c[b]||""})}}(),l=function(a,b){var c=i(b);if(c){var d,e=[];for(d in obj)e.push(d+": "+obj[d]);b=e.join(", ")}return j("[{storm}: {name}{spacer}{props}]",{storm:f.name,name:a,spacer:c?" - ":"",props:c?b:""})},m=function(a,b){return f[a]!==d?g.error(f.name+": Cannot mixin, "+a+" already exists: ",f[a]):(f[a]=b,void 0)};f.mixin=function(a,c){b.isString(a)&&m(a,c);var d;for(d in a)m(d,a[d])};var n=f.uniqId=function(){var a={};return function(b){b=b||"";var c=(a[b]||0)+1;return a[b]=c}}(),o=(f.uniqIdStr=function(a){return(a||"id")+""+n(a)},f.Extend=function(a,c){var d="function"==typeof a;d||(c=a);var e=this,f=function(){var b=e.apply(this,arguments);return d&&(b=a.apply(this,arguments)),b};b.extend(f,this);var g=function(){};return g.prototype=this.prototype,f.prototype=new g,b.extend(f.prototype,this.prototype,c),f.prototype.constructor=a||f,f}),p=f.Events=c;b.extend(f,p.core.construct());var q={idle:0,progressed:1,failed:2,done:3},r={done:0,fail:1,always:2,progress:3,pipe:4},s=b.invert(r),t=f.Promise=function(){this._calls={},this._status=q.idle};t.STATUS=q,t.CALL=r,t.prototype={constructor:t,done:function(a){return this._pushCall.call(this,r.done,a)},fail:function(a){return this._pushCall.call(this,r.fail,a)},always:function(a){return this._pushCall.call(this,r.always,a)},progress:function(a){return this._pushCall.call(this,r.progress,a)},pipe:function(a){return this._pushCall.call(this,r.pipe,a)},_pushCall:function(a,b){return this._getCalls(a).push(b),this},notify:function(){this._status=q.progressed;var a=this._runPipe(arguments);return this._fire(r.progress,a)._fire(r.always,a),this},reject:function(){return this._status=q.failed,this._fire(r.fail,arguments)._fire(r.always,arguments),this},resolve:function(){this._status=q.done;var a=this._runPipe(arguments);return this._fire(r.done,a)._fire(r.always,a),this},is:function(a){return b.isNumber(a)?this._status===a:this._status===t.STATUS[a]},status:function(){return this._status},_fire:function(a,b){for(var c=this._getCalls(a),d=0,e=c.length;e>d;d++)c[d].apply(null,b);return this},_runPipe:function(a){for(var b,c=this._getCalls(r.pipe),e=0,f=c.length;f>e;e++)b=c[e].apply(null,a),b!==d&&(a=[b]);return a},_getCalls:function(){return this._calls[s[callType]]||(this._calls[s[callType]]=[])},call:function(){var a=b.toArray(arguments);a.splice(0,1),this.notify.apply(this,a)},apply:function(a,b){this.notify.apply(this,b)},toString:function(){return l("Promise",{status:b.invert(q)[this._status],done:this._getCalls(r.done).length,fail:this._getCalls(r.fail).length,always:this._getCalls(r.always).length,progress:this._getCalls(r.progress).length,pipe:this._getCalls(r.pipe).length})}};f.when=function(a){var c=function(){this._p=null,this._events=[]};return c.prototype={constructor:c,init:function(){this._events=b.isArray(arguments[0])?arguments[0]:b.toArray(arguments),this._subscribe();var c=new a;return c.then=function(){this.done.apply(this,arguments)},this._p=c,c},_subscribe:function(){for(var a=b.bind(this._checkStatus,this),c=b.bind(this._fireProgress,this),d=this._events,e=d.length;e--;)d[e].done(a).fail(a).progress(c)},_checkStatus:function(){for(var b,c=this._events,d=c.length,e=0,f=0,g=d;g--;){if(b=c[g],b.status===a.STATUS.idle)return;b.status!==a.STATUS.done?b.status!==a.STATUS.failed||(f+=1):e+=1}this._fire(d,e,f,arguments)},_fire:function(b,c,d,e){var f=this._p;return c===b?f.resolve.apply(f,e):d===b?f.reject.apply(f,e):c+d===b?f._fire(a.CALL.always,e):void 0},_fireProgress:function(){var a=this._p;a.notify.apply(a,arguments)}},function(){var a=new c;return a.init.apply(a,arguments)}}(t);!function(){for(var b=0,c=["ms","moz","webkit","o"],d=0,e=c.length;e>d&&!a.requestAnimationFrame;d++)a.requestAnimationFrame=a[c[d]+"RequestAnimationFrame"],a.cancelAnimationFrame=a[c[d]+"CancelAnimationFrame"]||a[c[d]+"CancelRequestAnimationFrame"];a.requestAnimationFrame||(a.requestAnimationFrame=function(c){var d=(new Date).getTime(),e=Math.max(0,16-(d-b)),f=a.setTimeout(function(){c(d+e)},e);return b=d+e,f}),a.cancelAnimationFrame||(a.cancelAnimationFrame=function(a){clearTimeout(a)})}(),f.animate=function(){var c={},d=[],e=(a.requestAnimationFrame,null),h=!0;return _animate=function(){for(var b=0,c=d.length;c>b;)d[b](),b+=1;e=a.requestAnimationFrame(_animate)},_animate(),{hook:function(a){if(!b.isFunction(a))return g.error(f.name+": Parameter must be a function: ",a);var e=n("Animate");return c[e]=d.length,d.push(a),e},unhook:function(a){return d.splice(c[a],1),delete c[a],this},isRunning:function(){return this._isRunning},start:function(){return h?void 0:(h=!0,_animate(),this)},stop:function(){return h?(h=!1,a.cancelAnimationFrame(e),this):void 0}}}();var u={},v={send:function(a){u[a.getId()]||(u[a.getId()]=a,f.request.trigger("send",a))},done:function(a){f.request.trigger("done",a)},fail:function(a){f.request.trigger("fail",a)},abort:function(a){f.request.trigger("abort",a)},always:function(a){u[a.getId()]&&(delete u[a.getId()],f.request.trigger("always",a))}};f.request=p.core.construct(),b.extend(f.request,{getQueue:function(){return u},getTotal:function(){return b.size(u)}});var w={nonblocking:0,blocking:1};_addClassification=function(a){a in w||(w[a]=b.size(w))};var x=f.AjaxCall=function(a,b,c){this._id=n("AjaxCall"),this._call=this._configure(a,b,c)};b.extend(x,{CLASSIFICATION:w,addClassification:function(a){if(b.isArray(a))for(var c=0,d=a.length;d>c;c++)_addClassification(a[c]);else _addClassification(a)}}),x.prototype={constructor:x,defaults:{name:"",type:"GET",content:"application/json; charset=utf-8",url:"",cache:!1,classification:w.nonblocking},_configure:function(a,c,d){var e=b.extend({},this.defaults,d,a);return e.url=j(e.url,c),e},data:function(a){return arguments.length?(this._call.data=a,this):this._call.data},getConfiguration:function(){return this._call},getId:function(){return this._id},isType:function(a){return a.toUpperCase()===this._call.type.toUpperCase()},isClassification:function(a){return a===this._call.classification},get:function(a){return this.call[a]},set:function(a,b){return this.call[a]=b,this},send:function(a){var b=this,c=this.call,d=this.request=STORM.ajax.ajax({type:c.type,url:c.url,contentType:c.content,data:c.data,cache:c.cache,success:function(c){a&&a.resolve(c),b.success.apply(b,arguments),v.done(b)},error:function(c,d,e){return a&&a.reject(c),0===c.status?(v.abort(c,d,e,b),void 0):(b.error.apply(b,arguments),v.fail(b),void 0)},complete:function(){a&&a.resolve(data),b.complete.apply(b,arguments),v.always(b)}});return v.send(this),d},success:function(){},error:function(){},complete:function(){},abort:function(){return this.request&&(this.request.abort(),this.request=null),this},toString:function(){return l("AjaxCall",{id:this._id,call:JSON.stringify(this._call)})}};var y=f.DataContext=function(){this._id=n("DataContext")};y.settings=function(){var b=a.location||{};return{host:b.host,hostname:b.hostname,origin:b.origin,pathname:b.pathname,port:b.port}}(),y.addSettings=function(a){return b.extend(y.setting,a)},y.prototype={constructor:y,AjaxCall:x,defaults:{},options:{},callTemplate:{},getSetting:function(){return y.getSetting.apply(arguments)},removeSetting:function(){return y.removeSetting.apply(arguments)},extendOptions:function(a){return this.options=b.extend({},this.defaults,a),this},removeOption:function(a){return delete this.options[a],this},createCall:function(a,c){var d=b.extend({},y.settings,this.options,c);return new this.AjaxCall(a,d,this.callTemplate)},toString:function(){return l("DataContext",{id:this._id})}},f.template=function(){var a={},c={},d={compile:b.template},e=function(c,d){if(!b.isString(c)){var i,j=c;for(i in j)e(i,j[i]);return this}if("#"===c[0]){var k=document.getElementById(c.substring(1,c.length));if(!k)return g.error(f.name+': Cannot find reference to "'+c+'" in DOM');d=k.innerHTML}return a[c]=h(d),this},h=function(a){return b.isFunction(a)&&(a=a.call()),b.isString(a)?a.trim():b.isArray(a)?a.join("\n").trim():(g.error(f.name+": Template (or the return value) was of unknown type"),"")},i=function(b){var e=c[b];return e?e:(d||g.error(f.name+": No template engine is available"),c[b]=d.compile(a[b]))},j=function(b){delete a[b],delete c[b]},k=function(a,b){var c=i(a);return c(b||{})};return{add:e,remove:j,render:k,setEngine:function(a){d=a},toJSON:function(b){var c=b?a[b]:a;return c},toString:function(){return l("template",{size:b.size(a)})}}}();var z=f.View=function(a){p.core.call(this),this._id=n("View"),this.options=a||{},this.elem=a.elem||null,this.template=this.template||a.template||""};b.extend(z.prototype,p.core.prototype,{constructor:z,clone:function(){return new this.constructor(this.options)},render:function(){},getElem:function(){return this.elem||(this.elem=this.render())},toString:function(){return l("View",{id:this._id})}});var A=f.Model=function(a,c){p.core.call(this),this._id=n("Model"),this.options=c,this._getters={},this._setters={},a=b.extend({},this.defaults,a),this.__data=this._duplicate(a),this.__originalData=this.__previousData=this._duplicate(a),this.comparator&&this.comparator.bind(this)};b.extend(A.prototype,p.core.prototype,{constructor:A,supportComplexDataTypes:!1,defaults:{},getId:function(){return this._id},restore:function(a){if(this.__data=this._duplicate(this.__originalData),a&&!a.isSilent)return this;var b;for(b in this.__data)this.trigger("change:"+b,this.__data[b]),this.trigger("model:change",b,this.__data[b]);return this.trigger("model:restore"),this},getter:function(a,c){return b.isFunction(c)?this._getters[a]?g.error(f.name+": Getter is already defined",a,c):(this._getters[a]=c,this):g.error(f.name+": Getter must be a function.")},setter:function(a,c){return b.isFunction(c)?this._setters[a]?g.error(f.name+": Setter is already defined",a,c):(this._setters[a]=c,this):g.error(f.name+": Setter must be a function",a,c)},get:function(a){if(b.isArray(a)){for(var c=a.length;c--;)a[c]=this._get(a[c]);return a}return this._get(a)},_get:function(a){return this._getters[a]?this._getters[a].call(null,this.__data[args.prop]):this.__data[a]},set:function(a,c,d){if(!b.isString(a)){var e;for(e in a)this._set(e,a[e],d);return this}return this._set(a,c,d),this},_set:function(a,b,c){this._setters[a]&&(b=this._setters[a].call(null,b)),this._change(a,b,c)},add:function(a,c,d){if(!b.isString(a)){var e;for(e in a)this._add(e,a[e],d);return this}return this._add(a,c,d),this},remove:function(a,c){if(b.isArray(a)){for(var d=a.length;d--;)this._remove(a[d],c);return this}this._remove(a,c)},previous:function(a){return this.__previousData[a]},has:function(a){return i(a)?a in this.__data:!1},hasChanged:function(a){if(i(a))return this.__originalData[a]===this.__data[a]?!1:!0;var b;for(b in this.__data)if(this.hasChanged(b))return!0;return!1},clone:function(){return new this.constructor(this._duplicate(this.__data),this.options)},_duplicate:function(a){return i(a)?this.supportComplexDataTypes?b.clone(a):JSON.parse(JSON.stringify(a)):a},retrieve:function(){return this.__data},_backup:function(){this.__previousData=this._duplicate(this.__data)},_add:function(a,b,c){this._backup(),this.__previousData[a]===d&&(this.__data[a]=this._duplicate(b),this.__previousData[a]!==this.__data[a]&&(c&&c.isSilent||(this.trigger("add:"+a,b),this.trigger("model:add",a,b))))},_remove:function(a,b){if(this._backup(),this.__previousData[a]!==d){var c=this.__data[a];delete this.__data[a],b&&b.isSilent||(this.trigger("remove:"+a,c),this.trigger("model:remove",a,c))}},_change:function(a,c,d){return this._backup(),this.__data[a]=this._duplicate(c),b.isEqual(this.__previousData[a],this.__data[a])?void 0:this._validate()?(d&&d.isSilent||(this.trigger("change:"+a,c),this.trigger("model:change",a,c)),void 0):this.__data=this._duplicate(this.__previousData)},compareTo:function(a){return this.comparator&&a&&a.comparator?this.comparator.getSortValue(this).localeCompare(this.comparator.getSortValue(a)):0},_validate:function(){if(!this.validate)return!0;var a=!!this.validate();return a||this.trigger("model:invalid"),a},toJSON:function(){return this.__data},toString:function(){return l("Model",{id:this._id})}}),b.each(["each","isEqual","isEmpty","size","keys","values","pairs","invert","pick","omit"],function(a){A.prototype[a]=function(){var c=b.toArray(arguments);return c.unshift(this.__data),b[a].apply(b,c)}});var B={alphabetical:0,numeric:1,date:2},C=b.invert(B),D=function(a){a in B||(B[a]=b.size(B))},E={},F=f.Comparator=function(a,b){this._key=a,this._type=b||B.alphabetical};b.extend(F,{HOISTING_STR:"___",SORT:B,addSort:function(a){if(b.isArray(a))for(var c=0,d=a.length;d>c;c++)D(a[c]);else D(a);C=b.invert(B)}}),F.prototype={constructor:F,bind:function(a){a.on("change:"+this._key,b.bind(this.invalidateSortValue,this,a))},invalidateSortValue:function(a){return delete this.store[a.getId()],this},getSortValue:function(a){var b=a.getId();if(E[b])return E[b];if(!this[C[this._type]])return g.error(f.name+": Comparator does not have a method for the sort type assigned",this._type,C[this._type]);var c=this[C[this._type]].call(this,a);return E[b]=c,c},alphabetical:function(a){var c=a.get(this._key);return c=b.exists(c)?(c+"").toLocaleLowerCase():F.HOISTING_STR},numeric:function(a){var b=a.get(this._key)||0;return b=+b},date:function(a){var c=a.get(this._key)||new Date;return c=b.isDate(c)?c:new Date(c)},toString:function(){return l("Comparator",{id:this._id,key:this._key,type:C[this._type]})}};var G=f.Collection=function(a){p.core.call(this),a=a||{},this._id=n("Collection"),this._models=[],this.add(a.models,a,{isSilent:!0})};b.extend(G.prototype,p.core.prototype,{constructor:G,Model:A,getId:function(){return this._id},newModel:function(a,b,c){return new this.Model(a,b,c)},getModels:function(){return this._models},getBy:function(a,b){for(var c=this._models,d=c.length;d--;)if(c[d].get(a)===b)return c[d];return null},length:function(){return this._models.length},at:function(a){return this._models[a]},indexOf:function(a){for(var b=a.getId(),c=this._models,d=c.length;d--;)if(c[d].getId()===b)return d;return-1},add:function(a,c,d){a=b.isArray(a)?a.slice():[a],d=d||{};for(var e,g=0,h=a.length,j=[],k=d.at;h>g;g++)if(e=a[g])if(e instanceof f.Model||(e=this.newModel(e,d,c)),e._validate())if(this.get(e.getId())){if(d.merge){var l,m=a[g];for(l in m)e.set(l,m[l],d);d.isSilent||e.trigger("collection:merge")}}else j.push(e);else d.isSilent||this.trigger("collection:invalid",e,a);if(j.length&&(i(k)?this._models.splice([k,0].concat(j)):this._models.push(j),this.sort(d)),d.isSilent)return this;var n=this;return b.each(j,function(a){a.trigger("collection:add",n)}),this.trigger("add",j,d),this},set:function(){this.add.apply(this,arguments)},push:function(a,c){return c=b.extend({at:this._models.length},c),this.add(a,c),a},unshift:function(a,c){return c=b.extend({at:0},c),this.add(a,c),a},remove:function(a,c){a=b.isArray(a)?a.slice():[a],c=c||{};for(var d,e=0,f=a.length;f>e;e++)d=this.get(a[e]),d&&(this._models.splice(e,1),c.isSilent||d.trigger("collection:remove",this));return c.isSilent?this:(this.trigger("remove",a,c),this)},shift:function(a){var b=this.at(0);return this.remove(b,a),b},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},slice:function(a,b){return this._models.slice(a,b)},sort:function(a){if(a=a||{},a.skipSort||!this.length()||!this.at(0).comparator)return this;if(this._models.sort(function(a,b){return a.compareTo(b)}),!a.silent){var b=this;this.each(function(a,c){a.trigger("collection:sort",b,c)}),this.trigger("sort",this,a)}return this},where:function(a,c){if(b.isEmpty(a))return c?d:[];var e=this[c?"find":"filter"];return e(function(b){var c;for(c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},pluck:function(a){return b.invoke(this._models,"get",a)},getModelById:function(a){if(!i(a))return null;for(var b=this._models,c=b.length;c--;)if(b[c].getId()===a)return b[c];return null},get:function(){return this.getModelById.apply(this,arguments)},reset:function(a){return a=a||{},this._models.length=0,a.isSilent||this.trigger("reset"),this},clone:function(){return new this.constructor({model:this.model,models:this._models})},retrieve:function(){return b.map(this._models,function(a){return a.retrieve()})},toJSON:function(){return this.retrieve()},toString:function(){return l("Collection",{id:this._id,length:this.length()})}}),b.each(["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"],function(a){G.prototype[a]=function(){var c=b.toArray(arguments);return c.unshift(h(this._models)),b[a].apply(b,c)}}),b.each(["groupBy","countBy","sortBy"],function(a){G.prototype[a]=function(c,d){var e=b.isFunction(c)?c:function(a){return a.get(c)};return b[a](this._models,e,d)}});var H=f.Module=function(){p.core.call(this),this._id=n("Module")};b.extend(H.prototype,p.core.prototype,{constructor:H,toString:function(){return l("Module",{id:this._id})}});var I=f.Cache=function(){this._id=n("Cache"),this._cache={},this._timeouts={}};I.prototype={constructor:I,store:function(a,c,d){if(d=d||{},!b.isString(a)){d=c,c=a;var e;for(e in c)this._store(e,c[e],d);return this}return this._store(a,c,d),this},get:function(a){if(b.isArray(a)){for(var c=a.length;c--;)a[c]=this._cache[a[c]];return a}return this._cache[a]},remove:function(a){a=b.isArray(a)?a:[a];for(var c=a.length;c--;)this._clearExpiration(a[c]),delete this._cache[a[c]];return this},flush:function(){return this._clearExpirations(),this._cache={},this},_store:function(a,c,d){i(d.expiration)&&this._setExpiration(a,d.expiration),d.extend&&(c=b.extend(this._cache[a],c)),this._cache[a]=c},_setExpiration:function(a,c){this._timeouts[a]&&clearTimeout(this._timeouts[a]);var d=this;this._timeouts[a]=setTimeout(function(){delete d._cache[a],delete d._timeouts[a]},b.isNaN(c)?0:c)},_clearExpirations:function(){var a;for(a in this._timeouts)this._clearExpiration(a)},_clearExpiration:function(a){clearTimeout(this._timeouts[a]),delete this._timeouts[a]},toJSON:function(a){var b=a?this.get(a):this._cache;return b},toString:function(){return l("Cache",{id:this._id,size:b.size(this._cache)})}},f.cache=new I;var J={cookie:0,local:1,session:2},K=b.invert(J),L=f.Storage=function(c,d){d=d||{},this.type=c||J.cookie,this.name=d.name||K[this.type],this.storage=a[this.name+"Storage"],this.hasStorage=i(this.storage),this.data=this._getData(),this.length=this.hasStorage?this.storage.length:b.size(this.data)};L.TYPE=J,L.prototype={constructor:L,clear:function(){return this.data={},this.length=0,this.hasStorage?(this.storage.clear(),this):(this._clearCookieData(),this)},key:function(a){if(this.hasStorage)return this.storage.key(a);var b,c=0;for(b in this.data){if(c===a)return k;c++}return null},getItem:function(a){if(b.isArray){for(var c=a.length;c--;)a[c]=this.getItem(a[c]);return a}if(this.hasStorage){var d=this.storage.getItem(a);return i(d)?JSON.parse(d):d}return this.data[a]},get:function(){return this.getItem.apply(this,arguments)},setItem:function(a,c){if(b.isString(a)){if(this.hasStorage){var d=this.storage.setItem(a,JSON.stringify(c));return this.length=this.storage.length,d}this.data[a]=c,this.length++,this._setCookieData()}else{var e;for(e in a)this.setItem(e,a[e])}},store:function(){this.setItem.apply(this,arguments)},set:function(){this.setItem.apply(this,arguments)},removeItem:function(a){if(this.hasStorage){var b=this.storage.removeItem(a);return this.length=this.storage.length,b}delete this.data[a],this.length--,this._setCookieData()},remove:function(a){return this.removeItem(a),this},_createCookie:function(a){var b,c=this.type===L.TYPE.session?0:365,d=new Date;c>0?(d.setTime(d.getTime()+24*c*60*60*1e3),b=d.toGMTString()):b="0",document.cookie=j("{name}={value}; expires={expiration}; path=/",{name:this.name,value:a,expiration:b})},_readCookie:function(){for(var a,b=this.name+"=",c=document.cookie.split(";"),d=0,e=c.length;e>d;d++){for(a=c[d];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(b))return a.substring(b.length,a.length)}return null},_setCookieData:function(){var a=JSON.stringify(this.data);this._createCookie(a,365)},_clearCookieData:function(){this._createCookie("",365)},_getData:function(){var a=this.hasStorage?null:this._readCookie();return a?JSON.parse(a):{}},toJSON:function(a){var b=a?this.get(a):this._getData();return b},toString:function(){return l("Storage",{type:K[this.type],length:this.length})}},f.store=new L(L.TYPE.local),f.session=new L(L.TYPE.session),p.extend=I.extend=x.extend=y.extend=A.extend=G.extend=F.extend=z.extend=H.extend=o,f.noConflict=function(){return a.Storm=e,this},"undefined"!=typeof define&&define.amd&&define("Storm",[],function(){return f})}(this,_,Signal);
//# sourceMappingURL=StormJS-0.0.1.min.map